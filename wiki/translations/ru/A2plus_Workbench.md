 <img alt="Иконка верстака A2plus" src=images/A2p_workbench.svg  style="width:128px;">

## Введение


{{TOCright}}

Верстак A2plus - это [внешний верстак](External_workbenches/ru.md) для [создания сборок](Assembly/ru.md) деталей в FreeCAD.

Эта документация описывает версию A2plus **0.4.47 или новее**.

## Установка

Верстак A2plus - это дополнение к FreeCAD. Его легко установить через меню {{MenuCommand | Инструменты → [ Менеджер дополнений](Std_AddonMgr_.md)}}. A2plus находится в стадии активной разработки и будет часто получать новые функции. Поэтому вы должны регулярно обновлять его, используя меню {{MenuCommand | Инструменты → [ Менеджер дополнений](Std_AddonMgr_.md)}}. Код A2plus размещается и разрабатывается [на GitHub](https://github.com/kbwbe/A2plus), а также может быть установлен вручную путем копирования его в каталог MOD FreeCAD.

## Начало работы 

Сначала переключитесь на панель инструментов A2plus во FreeCAD. Для создания сборки создайте новый файл в FreeCAD. Сначала этот файл нужно сохранить. Рекомендуется (но не обязательно) сохранять его в той же папке, что будущая сборка деталей.

Теперь детали можно добавлять в сборку с помощью кнопки на панели инструментов <img alt="" src=images/_A2p_ImportPart.svg  style="width:24px;"> или <img alt="" src=images/A2p_ShapeReference.svg  style="width:24px;">. Кнопка <img alt="" src=images/A2p_ImportPart.svg  style="width:24px;"> добавляет все тела в выбранном файле как единую деталь. При использовании кнопки <img alt="" src=images/A2p_ShapeReference.svg  style="width:24px;"> Вы можете выбрать, какие детали из файла должны быть импортированы как деталь. Так можно, например, импортировать только эскиз для сборки дальнейших частей, используя эскиз для определения позиций деталей.

Первая добавленная часть получает фиксированную позицию по умолчанию. (Это можно изменить позже через свойство детали **фиксированная позиция**.)

Детали, уже находящиеся в сборке, можно клонировать с помощью кнопки на панели инструментов <img alt="" src=images/_A2p_DuplicatePart.svg  style="width:24px;">.

Чтобы отредактировать деталь из сборки, выберите ее в дереве модели и используйте кнопку на панели инструментов <img alt="" src=images/A2p_EditPart.svg  style="width:24px;">. Это откроет деталь в новой вкладке во FreeCAD или переключится на ее вкладку, если файл уже открыт.

Чтобы импортировать изменения деталей в сборку, нажмите кнопку на панели инструментов <img alt="" src=images/_A2p_ImportPart_Update.svg  style="width:24px;">. Кнопка на пранели <img alt="" src=images/A2p_RecursiveUpdate.svg  style="width:24px;"> тоже импортирует детали, но по возможности рекурсивно [подсборки](#Узлы_сборки.md). Если Вы выберете одну или несколько частей в древе проекта FreeCAD, A2plus запросит Вас об обновлении только выбранных частей.

Импортированные части сохранят свои внешние зависимости и могут быть отредактированы. Однако для стандартных частей, таких как винты, полезно, чтобы их форму нельзя было редактировать. Это может быть достигнуто с помощью кнопки на панели инструментов <img alt="" src=images/_A2p_ConvertPart.svg  style="width:24px;">, которая преобразует выбранную деталь в статическую копию оригинальной детали.

Чтобы сохранить сборку и затем закрыть ее, можно использовать кнопку на панели инструментов <img alt="" src=images/_A2p_Save_and_exit.svg  style="width:24px;">.

## Сборка

Сборка деталей осуществляется путем добавления ограничений между деталями. После введения ограничения A2plus переместит детали в соответствии с ограничением, если это возможно.

Ограничения между деталями добавляются удерживанием клавиши **Ctrl** и выбором ребра или грани двух частей. Затем нажмите кнопку на панели инструментов нужного ограничения. Появится диалог, определённый в разделе [Constraints](#Constraints.md). Ограничение будет добавлено в дереве модели к выделенным деталям.

Для сложных ограничений между частями A2plus может не справится с расположением деталей. Поэтому также ознакомьтесь с разделом [Устранение неполадок](#Troubleshooting.md), чтобы узнать, как решить такие случаи.

### Отслеживание

Чем больше частей вы добавляете, тем важнее сохранять возможность их отслеживания. A2plus предлагает следующие инструменты для перемещения и просмотра деталей:

-   Чтобы переместить деталь в сборке, выберите ее в дереве модели и используйте кнопку на панели инструментов <img alt="" src=images/_A2p_MovePart.svg  style="width:24px;">. Когда вы разместите деталь там, где вам это нравится, щелкните левой кнопкой мыши. Если перемещенная деталь уже имеет ограничения, она будет размещена соответствующим образом при нажатии кнопки на панели инструментов <img alt="" src=images/_A2p_solver.svg  style="width:24px;">, потому что это инициирует разрешение всех ограничений сборки.
-   Чтобы отобразить ограничение, выберите его в дереве модели и используйте кнопку на панели инструментов <img alt="" src=images/_A2p_ViewConnection.svg  style="width:24px;">. Это сделает всю сборку прозрачной и выделит два объекта, связанных ограничениями. Чтобы вернуться к обычному виду, щелкните левой кнопкой мыши по сборке.
-   Чтобы показать только определенные детали в сборке, выберите эти детали в дереве модели и используйте кнопку на панели инструментов <img alt="" src=images/_A2p_Isolate_Element.svg  style="width:24px;">. В качестве альтернативы вы можете скрыть определенную деталь, выбрав ее в дереве модели и нажав **Space**, чтобы переключить ее видимость.
-   Для переключения вида прозрачности всей сборки вы можете использовать кнопку панели инструментов <img alt="" src=images/_A2p_ToggleTransparency.svg  style="width:24px;">.
-   Каждая деталь может быть сделана прозрачной при использовании обычного редактирования FreeCAD. Однако, иногда установки прозрачности деталей пропадают при повторном открытии сборки из-за ошибки в FreeCAD. В качестве обходного пути можно использовать кнопку на панели <img alt="" src=images/A2p_Restore_Transparency.svg  style="width:24px;"> для восстановления установок прозрачности.

### Ограничения

При создании ограничения, после нажатия кнопки на панели инструментов ограничения, будет отображаться такой диалог:

![](images/A2p_ConstraintPropertiesDialog.png ) *Выше: Диалог параметров ограничений A2plus*

Для определенных ограничений это позволяет вам изменить направление ограничения. С помощью кнопки **<img src="images/A2p_solver.svg" width=24px> Solve** вы можете заранее проверить, может ли это новое ограничение быть решено с помощью A2plus. Если нет, загляните в раздел [Разрешение проблем](#Разрешение_проблем.md).

Ограничения могут быть сброшены изменением их [видимости](Std_ToggleVisibility/ru.md). Это делается выбором ограничения в древе проекта и нажатием **Space**. Это переключает свойство **Suppressed** (подавлено). Подавленное ограничение не учитывается при разрешении сборки.

A2plus поддерживает следующие ограничения:

#### Точка на точке 

Выберите [Вершины](Glossary#Vertex.md) (точки) в каждой детали. Кнопка на панели инструментов <img alt="" src=images/_A2p_PointIdentity.svg  style="width:24px;"> добавляет ограничение {{Variable|pointIdentity}}. Это сделает точки совпадающими.

#### Точка на линии 

Выберите [вершину](Glossary#Vertex.md) (точку), или [край](Glossary#Edge.md) окружности (выберет ее центр), или [поверхность](Glossary#Face.md) сферы (также выберет ее центр) и [ край](Glossary_#_Edge.md) детали. Кнопка на панели инструментов ![ 24px](images/_A2p_PointOnLineConstraint.svg ) добавляет ограничение {{Variable|pointOnLine}}. Это поместит точку на край.

#### Точка на плоскости 

Выберите [вершину](Glossary#Vertex.md) (точку), или [край](Glossary#Edge.md) окружности (выберет ее центр), или [поверхность](Glossary#Face.md) сферы (также выберет ее центр) и плоскость. Кнопка на панели инструментов <img alt="" src=images/_A2p_PointOnPlaneConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable|pointOnPlane}}. Диалог ограничений позволяет указать смещение между точкой и плоскостью. Это смещение также можно переключать между обеими сторонами плоскости. Если смещение равно нулю, ограничение поместит вершину на плоскость.

#### Сфера на Сфере 

Выберите [поверхность](Glossary#Face.md) сфер или [вершины](Glossary#Vertex.md) (точки) на обеих деталях. Кнопка на панели инструментов <img alt="" src=images/_A2p_SphericalSurfaceConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable |phereCenterIdent}}. Это совместит центры сфер, центр сферы и точку, либо вершины.

#### Круговая кромка на круговой кромке 

Выберите [край](Glossary#Edge.md) окружности на обеих деталях. Кнопка на панели инструментов <img alt="" src=images/_A2p_CircularEdgeConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable | roundEdge}}. Диалог ограничений позволяет указать смещение между краями. Это смещение также можно перевернуть. Кроме того, вы можете установить направление ограничения и заблокировать вращение частей. Если смещение равно нулю, ограничение поместит края окружности в одной плоскость.

#### Совпадение по оси 

Выберите [поверхность](Glossary_#_Face.md) сферы или [ края](Glossary_#_Edge.md) линий на обеих частях. Кнопка на панели инструментов <img alt="" src=images/_A2p_AxialConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable|axisCoincident}}. Диалог ограничений позволяет указать направление оси. Диалог позволяет вам также заблокировать вращение частей. Ограничение сделает оси или линии совпадающими.

#### Параллельные оси 

Выберите [поверхность](Glossary_#_Face.md) сферы или [ края](Glossary_#_Edge.md) линий на обеих частях. Кнопка на панели инструментов ![ 24px](images/_A2p_AxisParallelConstraint.svg ) добавляет ограничение {{Variable|axisParallel}}. Диалог ограничений позволяет указать направление оси. Ограничение сделает оси или линии параллельными.

#### Ось параллельно плоскости 

Выберите цилиндрическую [поверхность](Glossary/ru#Face.md) или линейные [края](Glossary/ru#Edge.md) детали и плоскость на другой детали. Кнопка на панели инструментов <img alt="" src=images/_A2p_AxisPlaneParallelConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable|axisPlaneParallel}}. Ограничение сделает ось или линию параллельной плоскости.

#### Ось нормально плоскости 

Выберите цилиндрическую [поверхность](Glossary/ru#Face.md) или линейные [края](Glossary/ru#Edge.md) детали и плоскость на другой детали. Кнопка на панели инструментов <img alt="" src=images/A2p_AxisPlaneNormalConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable|axisPlaneNormal}}. Ограничение сделает ось или линию нормальной плоскости.

#### Ось под углом к плоскости 

Выберите цилиндрическую [поверхность](Glossary/ru#Face.md) или линейные [края](Glossary/ru#Edge.md) детали и плоскость на другой детали. Кнопка панели инструментов <img alt="" src=images/A2p_AxisPlaneAngleConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable|axisPlaneAngle}}. Это ограничение сначала сделает оси параллельными плоскости. Затем вы можете отрегулировать угол для оси в появившемся диалоговом окне настроек ограничения.

#### Плоскости Параллельны 

Выберите две плоскости. Кнопка на панели инструментов <img alt="" src=images/_A2p_PlanesParallelConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable | planesParallel}}. Диалог ограничений позволяет вам указать направление ограничения. Ограничение сделает плоскости параллельными.

#### Плоскость на Плоскости 

Выберите две плоскости. Кнопка на панели инструментов <img alt="" src=images/_A2p_PlaneCoincidentConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable | planeCoincident}}. Диалог ограничений позволяет указать направление ограничения и смещение между плоскостями. Это смещение также можно перевернуть. Если смещение равно нулю, ограничение сделает плоскости совпадающими.

#### Плоскость под углом 

Выберите две плоскости. Кнопка на панели инструментов <img alt="" src=images/_A2p_AngleConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable | angledPlanes}}. Диалог ограничений позволяет указать угол между плоскостями. Ограничение сначала сделает плоскости параллельными и установит из под заданным углом.

#### Совпадение в Центре масс 

Выберите либо две замкнутые области, либо две плоскости. Кнопка на панели инструментов <img alt="" src=images/_A2p_CenterOfMassConstraint.svg  style="width:24px;"> добавляет ограничение {{Variable|centerOfMass}}. Диалог ограничений позволяет указать смещение между краями или плоскостями. Это смещение также можно перевернуть. Кроме того, вы можете установить направление ограничения и заблокировать вращение частей. Если смещение равно нулю, ограничение поместит области или плоскости в одну плоскость.

### Узлы сборки 

Сборка может содержать другие сборки. Они добавляются как детали путем нажатия кнопки на панели инструментов <img alt="" src=images/_A2p_ImportPart.svg  style="width:24px;"> и выбора файла {{FileName|* .FCStd}}, содержащего сборку. Такие узлы также можно редактировать как детали, используя кнопку на панели инструментов <img alt="" src=images/_A2p_EditPart.svg  style="width:24px;">. Убедитесь, что для более высоких этапов сборки вы обновили сборку рекурсивно с помощью кнопки на панели инструментов <img alt="" src=images/A2p_RecursiveUpdate.svg  style="width:24px;">, когда произошли изменения.

## Обработка ограничений 

Возможные ограничения для выбора отображаются на панели инструментов и в диалоговом окне «Инструменты ограничения» при включении соответствующих кнопок. Диалоговое окно «Инструменты ограничения» открывается с помощью кнопки панели инструментов <img alt="" src=images/_A2p_DefineConstraints.svg  style="width:24px;">. Он должен оставаться открытым, чтобы можно было быстро добавить несколько ограничений в сборку.

Существующие ограничения можно отредактировать, выбрав их в дереве модели, а затем дважды щелкнув по нему или нажав кнопку на панели инструментов <img alt="" src=images/_A2p_EditConstraint.svg  style="width:24px;">. Откроется диалоговое окно «Свойства ограничения».

Ограничения могут быть временно отключены выделением их в древе модели и изменением у элемента параметра **Suppressed**.

Ограничения можно удалить, выбрав их в дереве модели и нажав **Del**, или выбрав деталь с ограничениями в дереве модели и нажать кнопку на панели инструментов <img alt="" src=images/_A2p_DeleteConnections.svg  style="width:24px;">.

Все ограничения могут быть разрешены в любое время с помощью кнопки на панели инструментов <img alt="" src=images/_A2p_solver.svg  style="width:24px;">. Если кнопка панели инструментов ![ 24px](images/_A2p_ToggleAutoSolve.svg ) включена, разрешение выполняется автоматически после каждого редактирования ограничения.

Кнопка на панели инструментов <img alt="" src=images/_A2p_FlipConstraint.svg  style="width:24px;"> влияет на ограничение, которое было недавно добавлено. Это переворачивает направление ограничения.

## Списки деталей 

Чтобы создать списки деталей сборок, разные детали сборки должны получить информацию о детали, которая может быть прочитана A2plus. Это делается путем редактирования детали с помощью кнопки на панели инструментов <img alt="" src=images/_A2p_EditPart.svg  style="width:24px;">. В открывшейся части нажмите кнопку панели инструментов <img alt="" src=images/_A2p_PartsInfo.svg  style="width:24px;"> и [ электронная таблица](Spreadsheet_Workbench.md) с именем *\#PARTINFO\#*.

Структура электронной таблицы выглядит следующим образом:

![](images/A2p_PartinfoTable.png )

Заполните серые поля имеющейся информацией. Эта информация будет отображена в окончательном списке деталей.

В сборке или узле сборки используйте кнопку на панели инструментов <img alt="" src=images/_A2p_PartsList.svg  style="width:24px;">. Он спросит вас, хотите ли вы выполнить рекурсивную итерацию по всем узлам сборки. Нажмите «Да». Это создаст новую электронную таблицу с именем *\#PARTSLIST\#*. Он содержит информацию из различных электронных таблиц деталей *PARTSINFO\#* в списке вида:

![](images/A2p_PartslistTable.png )

Положение (POS) автоматически устанавливается в соответствии с внешним видом деталей в дереве модели. Часть верхнего уровня получит POS 1.

Количество (QTY) автоматически рассчитывается из сборки. Если деталь в сборке дважды, то QTY будет равно 2.

Если вы обновили информацию о детали, вы можете обновить список деталей, снова нажав кнопку на панели инструментов <img alt="" src=images/_A2p_PartsList.svg  style="width:24px;">.

Для сборочных узлов вы также можете создать информационную электронную таблицу с помощью кнопки на панели инструментов <img alt="" src=images/_A2p_PartsInfo.svg  style="width:24px;">. Когда вы создаете или обновляете список деталей главной сборки, эта информация будет использоваться, если вы ответите «Нет» на вопрос, хотите ли вы рекурсивно выполнять итерации по всем узлам сборки. Тогда разные детали будут находится не в списке деталей, а только в узлах сборки.

## Специальные возможности 

### Структура сборки 

Кнопка на панели инструментов <img alt="" src=images/_A2p_Treeview.svg  style="width:24px;"> создает файл HTML со структурой вашей сборки. Файл по умолчанию будет создан в текущем каталоге вашей сборки. Структура выглядит следующим образом:

:   ![](images/A2p_Dependency-Tree.jpg )

### Степени свободы 

Кнопка <img alt="" src=images/A2p_DOFs.svg  style="width:24px;"> помечает каждую часть сборки степенями свободы. Кроме того, он выводит список со всеми деталями и их зависимостями. Список выводится в виджет FreeCAD «Представление отчета». Если этот виджет в настоящее время не отображается, его можно отобразить, щелкнув правой кнопкой мыши пустую часть области панели инструментов FreeCAD и выбрав его в появившемся контекстном меню, или с помощью меню **View → Panels  → [Просмотр отчета](Report_view/ru.md)**.

Метки степеней свободы можно удалить, повторно нажав кнопку <img alt="" src=images/A2p_DOFs.svg  style="width:24px;">.

### Метки деталей 

Кнопка <img alt="" src=images/A2p_PartLabel.svg  style="width:24px;"> присваивает каждой детали сборки в 3D-виде уникальное имя. Метки деталей можно удалить повторно нажав кнопку <img alt="" src=images/A2p_PartLabelRemove.svg  style="width:24px;">.

### Вид всей сборки 


<div class="mw-translate-fuzzy">

Иногда необходимо объединить всю сборку в одну форму. Затем эту форму можно использовать, например, для 3D-печати в [ Mesh Workbench](Mesh_Workbench.md) или для создания чертежей в [ TechDraw Workbench](TechDraw_Workbench.md). Он создается с помощью кнопки панели инструментов <img alt="" src=images/_A2p_SimpleAssemblyShape.svg  style="width:24px;">. Форма по умолчанию не отображается. Используйте ту же кнопку на панели инструментов, чтобы обновить форму в случае изменений в сборке.


</div>

### Конвертировать абсолютные пути в относительные 

С помощью меню **A2plus → Misc → <img src=images/A2p_SetRelativePathes.svg style="width:24px"> Convert absolute paths of imported parts to relative ones** Вы можете конвертировать абсолютные пути импортированных деталей в относительные.

## Настройки

Доступ к настройкам a2plus можно получить через меню FreeCAD {{MenuCommand | Edit → [ Preferences](Preferences_Editor_.md)}} выбрав раздел «A2plus». Вы можете установить следующие параметры:

### Метод решения по умолчанию 

Использовать решения частичных систем: Решатель начинает с детали, для которой свойство **фиксированная позиция** установлено в значение *true*, а часть ограничена этим. Все остальные части не рассчитываются. Если решение может быть найдено, добавляется следующая часть ограничений для расчета и так далее.
Использовать «магнитный» решатель, решая все детали одновременно: Решатель пытается переместить все детали сразу в направлении к детали, у которой свойство **фиксированная позиция** установлено в *true*. Обратите внимание, что в большинстве случаев это займет больше времени для расчета.
Принудительно фиксировать положение: Для всех деталей в сборке свойство **фиксированная позиция** устанавливается в значение *true*. Тогда никакие расчеты фактически не выполняются, поскольку все детали всегда будут привязаны к позициям, в которых они были созданы.

### Поведение решателя по умолчанию 

Solve automatically if a constraint property is changed : The solver will automatically be started. The same as turning on the toolbar button <img alt="" src=images/A2p_ToggleAutoSolve.svg  style="width:24px;">.


<div class="mw-translate-fuzzy">


Решить автоматически, если изменён параметр ограничения: Решатель будет запущен автоматически. Аналогично включению кнопки на панели инструментов <img alt="" src=images/_A2p_ToggleAutoSolve.svg  style="width:24px;">.

### Поведение при обновлении импортированных деталей 


</div>


Пересчитать импортированные детали перед их обновлением: Все детали сборки, включая узлы сборок, будут открыты в FreeCAD для реконструкции с использованием значений из электронных таблиц.
Эта функция предназначена для полного параметрирования конструкции. **Примечание:** Эта функция очень экспериментальная и не рекомендуется для важных проектов.
Известные проблемы:

-   Сборка может быть уничтожена из-за неправильных ссылок на топологические имена в деталях
-   Основные электронные таблицы могут быть повреждены, когда они редактируются, а файл детали уже закрыт. Это может привести к краху FreeCAD.

Включить рекурсивное обновление импортированных деталей: Открывает все узлы сборки рекурсивно для их обновления.





Использовать экспериментальное топологическое именование: При импорте деталей в сборку алгоритм генерирует топологические имена для каждого узла сборки импортируемой фигуры. Топологические имена записываются в **mux Info**. Когда импортируемая деталь должна быть обновлена, эти топологические имена используются для обновления подэлементов ограничений. Таким образом, сборки становятся более устойчивыми к изменчивым числам подэлементов в FreeCAD.
\'\' \'Примечание:\' \'\' Это увеличивает размеры файлов и время расчета при импорте деталей. Если необходимо использовать топологическое именование, оно должно быть активировано до создания сборки.





Наследовать прозрачность для каждой поверхности из деталей и узлов: Использовать настройки цвета и прозрачности из импортированных деталей.
**Примечание:** Эта функция очень экспериментальная и не рекомендуется для важных проектов.





Не импортировать невидимые фигуры: Это позволит скрыть невидимые базовые / строительные фигуры. **Примечание:** Никакие ограничения не должны быть связаны с опорными / конструктивными формами в вышестоящих или других сборочных узлах. В противном случае вы можете сломать сборку.


<div class="mw-translate-fuzzy">


Использовать сплошное объединение для импорта деталей и сборочных узлов: Все импортированные детали будут напрямую объединены в объединение.
Эта функция полезна для моделирования [FEM](FEM_Workbench.md) или [3D-печать](Manual:Preparing_models_for_3D_printing.md), если разрешено только одно тело. Альтернативой является создание [вида всей сборки](#Shape_of_whole_Assembly.md) позже.


</div>

### Настройки интерфейса пользователя 

Показать ограничения на панели инструментов: Если эта опция не используется, кнопки панели инструментов для различных ограничений не видны, чтобы сэкономить место на панели инструментов. Новые ограничения по-прежнему можно установить с помощью диалогового окна «Инструменты ограничения» (кнопка на панели инструментов <img alt="" src=images/_A2p_DefineConstraints.svg  style="width:24px;">).

### Хранение файлов 

Использовать относительные пути для импортированных деталей: Использует относительные пути к файлам деталей.
Использовать абсолютные пути для импортированных деталей: Использует абсолютные пути к файлам деталей.
Все файлы находятся в этой папке проекта: Все файлы проекта должны находиться в указанной папке. Не имеет значения, находятся ли они в подпапках этой папки. \'\' \'Примечание:\' \'\' Одинаковые файлы не могут присутствовать несколько раз в папке (например, в разных подпапках).
Эта опция полезна для работы на разных машинах, потому что тогда нужно только скопировать папку проекта.

## Разрешение проблем 

Рано или поздно у вас возникнет проблема, что A2plus не может решить установленные вами ограничения. Чтобы преодолеть это, существуют разные стратегии:

### Использование Conflict Finder Tool 

Conflict Finder Tool (Инструмент Поиска Конфликтов) - Это самый безопасный метод, когда у вас есть несколько ограничений, потому что этот инструмент пытается решить одно ограничение за другим, пока не найдет конфликтующее ограничение. Затем вы можете перейти к другим стратегиям для устранения выявленного ограничения. Инструмент вызывается с помощью кнопки на панели инструментов <img alt="" src=images/A2p_SearchConstraintConflicts.svg  style="width:24px;">.

### Проверка направления ограничения 

Иногда кажется, что ограничения определены последовательно, но они, тем не менее, не могут быть решены. Пример: Предположим, у вас есть ограничение {{Variable | [ planesParallel](#_Plane_Parallel_.md)}} для двух плоскостей. Теперь вы хотите установить для этих же плоскостей ограничение {{Variable | [ planeCoincident](#_Plane_on_Plane_.md)}}, и A2plus не может решить эту проблему. Тогда направления ограничений {{Variable | planesParallel}} и {{Variable | planeCoincident}} различны. Используйте одно и то же направление для обоих ограничений, чтобы исправить это.

A2plus предлагает автоматическую проверку правильных направлений для **всех** ограничений, используя кнопку панели инструментов <img alt="" src=images/A2p_ReAdjustConstraints.svg  style="width:24px;">.

### Удаление ограничений 

Большинство случаев неразрешимых ограничений происходит непосредственно при добавлении нового ограничения. Решение состоит в том, чтобы удалить ограничение, которое вы добавили последним. A2plus также предложит это.

Иногда стратегия удаления является единственной, например, когда вы отредактировали деталь в FreeCAD так, что грани или ребра, связанные с ограничениями, отсутствуют. Затем следует удалить ограничение по одному, которое связано с измененной деталью. Используйте кнопку на панели инструментов <img alt="" src=images/_A2p_solver.svg  style="width:24px;"> после каждого удаления, чтобы увидеть, достигли ли вы разрешимого состояния.

Когда вы получите сборку, которую можно решить, добавьте шаг за шагом необходимые ограничения.

### Перемещение деталей 

В некоторых случаях решателю нужны только лучшие начальные значения для решения ограничений. Возьмем, к примеру, случай, когда у вас есть осевая часть и колесная часть. Вы добавляете ограничение {{Variable | axisCoincident}} и не получаете информации о том, что решатель не выполнен, но части не перемещаются соответствующим образом, и в виджете «Представление отчета» FreeCAD вы видите \"*REACHED POS-ACCURACY: 0.0*\". Решением для этого является перемещение деталей ближе к той позиции, которую вы хотите получить с помощью ограничения.

**Примечание:** Убедитесь, что хотя бы для одной части ограничения свойство {{PropertyData | фиксированная позиция}} установлено в значение *false*.

### Настройка свойства Tip 

Если вы пропустили некоторые функции своей детали после импорта в сборку A2plus, проверьте свойство **[Tip](PartDesign_MoveTip.md)**.

A2plus импортирует тела деталей со всеми их функциями вплоть до свойства Tip. Это разумно, потому что установка Tip на определенную функцию означает, что все функции после Tip не должны появляться в итоговой детали. Так что если Вы пропустили функцию детали в A2plus, откройте деталь через кнопку панели инструментов <img alt="" src=images/A2p_EditPart.svg  style="width:24px;">, выделите тело и посмотрите свойство **Tip**. Если это свойство не в той функции, где нужно, сделайте правый клик на функции, где оно должно быть и выберите **<img src=images/PartDesign_MoveTip.svg style="width:24px"> Set tip**.Затем сохраните деталь и перезагрузите сборку с помощью кнопки на панели инструментов <img alt="" src=images/A2p_ImportPart_Update.svg  style="width:24px;">.

### Восстановление дерева сборки 

Если вы не видите четкой причины, по которой некоторые ограничения не могут быть разрешены, вы можете попробовать использовать кнопку на панели инструментов <img alt="" src=images/_A2p_RepairTree.svg  style="width:24px;">. Это разрешит все ограничения и снова сгруппирует их по разным частям.

### Перенос старых сборок A2plus 

Сборки, созданные с A2plus старше марта 2019 года, не показывают правильные значки для импортированных деталей и имеют устаревшие свойства. Эти сборки можно перенести в A2plus версии 0.4.35 и новее, используя меню **A2plus → Misc → <img src=images/A2p_Upgrade.svg style="width:24px"> Migrate proxies of imported parts**. Сделав это, вы должны сохранить и снова открыть файл сборки.

### Избегайте символов подчеркивания 

**Эта стратегия не нужна для Windows.**

В некоторых операционных системах могут возникнуть проблемы, если имена файлов или пути к файлам деталей или сборки содержат символы с подчеркиванием. Поэтому избегайте таких символов, а также специальных символов в целом.

### Фиксированная позиция 

**Эта стратегия больше не нужна для сборок, созданных с использованием A2plus 0.3.11 или новее, поскольку A2plus теперь выдает предупреждение о пропущенных фиксированных позициях.**

Когда вы устанавливаете ограничение между двумя деталями, и ни одна деталь не имеет свойств {{PropertyData | фиксированная позиция}} установленным в *true* или связано ограничением с деталью с {{PropertyData | фиксированная позиция}} установленным в *true*, ограничение не может быть решено. То же самое происходит, если в обеих частях ограничения {{PropertyData | фиксированная позиция}} установлено значение *true*.

Затем A2plus выводит информацию о неудачном решении, но иногда вы видите только то, что детали не перемещаются соответствующим образом, и в виджете «Представление отчета» FreeCAD вы видите «REACHED POS-ACCURACY: 0.0». Это означает, что решатель завершил работу без ошибок, но на самом деле он не смог решить ограничения.

Поэтому убедитесь, что хотя бы для одной из ваших деталей в сборке **фиксированная позиция** установлено значение *true*. Затем убедитесь, что вы устанавливаете ограничения только для детали, которая каким-то образом связана с фиксированной деталью. Чтобы визуализировать эти зависимости, см. Раздел [Структура сборки](#Assembly_Structure.md).

### Вращение деталей 

**Эта стратегия больше не требуется для сборок, созданных с использованием A2plus 0.4.0 или новее, поскольку A2plus автоматически поворачивает детали в фоновом режиме, чтобы получить достаточный начальный угол для решателя.**

Решатель часто не выполняется для ограничения {{Variable|angledPlanes}}, если две выбранные плоскости в настоящее время имеют угол 0 ° или 180 °. (Части не перемещаются соответственно, и в виджете «Просмотр отчета» FreeCAD вы видите «REACHED POS-ACCURACY: 0.0».) Решение этой проблемы - повернуть одну часть на несколько градусов с помощью FreeCAD функция преобразования (щелкните правой кнопкой мыши деталь в дереве модели и выберите в контекстном меню **Transform**).

**Примечание:** Убедитесь, что хотя бы для одной части ограничения свойство {{PropertyData | фиксированная позиция}} установлено в значение *false*.

## Анимация

A2plus предлагает анимацию с помощью перетаскивания и скриптов Python.

### Перетаскиванием

Анимация перетаскиванием интерактивна, поскольку вы запускаете её, перетаскивая часть сборки. Чтобы получить этот тип анимации:

1.  Полностью ограничьте деталь, движение или вращение которой нужно анимировать.
2.  Нажмите на кнопку панели инструментов <img alt="" src=images/A2p_MovePartUnderConstraints.svg  style="width:24px;">. Это включает режим перетаскивания.
3.  Нажмите на нужную деталь в сборке.
4.  Теперь вы можете перемещать мышь, и деталь будет следовать за движением мыши в пределах установленных ограничений.
5.  Чтобы завершить режим перетаскивания, щелкните левой кнопкой мыши в сборке или нажмите ESC.

Вот пример сборки, чтобы попробовать анимацию перетаскиванием: [A2p\_example-for-dragging-animation.FCStd](https://forum.freecadweb.org/download/file.php?id=99204)

![](images/A2p_dragging-animation-result.gif )


*Выше: анимация перетаскивания с использованием примера сборки*

### Скриптами

Хотя режим перетаскивания предлагает приятные интерактивные анимации, они порой недостаточно точны для скринкастов или видео. Скриптовые анимации имеют то преимущество, что они анимируют движения и вращения определенным образом. Например, вы можете повернуть деталь ровно на 10° назад и вперед. В следующих примерах используется сборка, в которой деталь должна вращаться. Если вы попытаетесь анимировать это с помощью режима перетаскивания, вы увидите, как трудно получить вращение вперед-назад, чтобы, например, показать своему боссу в презентации. С помощью интерактивного сценарного примера, в то же время, это простая задача.

Скриптовая анимация обычно работает следующим образом:

1.  Сборку полностью ограничивают
2.  Сценарий изменяет параметр, например, положение или угол поворота детали.
3.  После изменения параметра разрешаются ограничения сборки
4.  Шаг 2. и 3. повторяются, чтобы получить анимацию.

Также можно изменить вместо параметра размещения ограничение, например, расстояние между двумя плоскостями.

#### Пример простого скрипта 

Самый простой способ написать сценарий анимации - это неинтерактивная анимация, которая следует заданному движению. Вот пример: Сначала скачайте этот сборочный файл [A2p\_animated-example.FCStd](https://forum.freecadweb.org/download/file.php?id=97554) и этот скрипт Python [A2p\_animation-example-script.py](https://forum.freecadweb.org/download/file.php?id=97981).


<div class="mw-collapsible mw-collapsed toccolours">

Вот содержимое скрипта. Строки, начинающиеся с «\#», описывают, что делают его разные строки:


<div class="mw-collapsible-content">


```python
# импорт библиотек
import time, math, PySide
import A2plus.a2p_solversystem as a2p_solver

# используем шаг в 1 градус
step = 1
# ждём 1 ms между шагами
timeout = 0.001
# начальный угол будет 0 градусов
angle = 0
# берём текущий открытый документ
document = FreeCAD.activeDocument()
# далее мы хотим менять угол вращения детали "star_wheel_001"
starWheel = document.getObject("star_wheel_001")
# определяем диалог хода выполнения от 0 до 360
progressDialog = PySide.QtGui.QProgressDialog(u"Animation progress", u"Stop", 0, 360)

# блок while является основным циклом для изменения угла и 
# разрешения ограничений сборки пошагово
while angle < 360: # запускает цикл пока мы не выполним полный оборот (360 градусов)
    # прибавляем угол вращения
    angle += step
    # устанавливаем новый угол в диалоге хода выполнения
    progressDialog.setValue(angle)
    # изменение угла вращения детали "star_wheel_001"
    starWheel.Placement.Rotation.Angle = math.radians(angle)
    # разрешение ограничений
    a2p_solver.solveConstraints(document, useTransaction=True)
    # обновление вида после разрешения ('Gui' здесь графический интерфейс)
    FreeCADGui.updateGui()
    # вынесение диалога хода выполнения на первый план
    PySide.QtGui.QWidget.raise_(progressDialog)
    # если будет нажата кнопка 'Stop', выйти из цикла
    if progressDialog.wasCanceled():
        angle = 360
    # сделать паузу перед следующим шагом
    time.sleep(timeout)
```


</div>


</div>

Чтобы использовать скрипт для выполнения анимации, мы должны

1.  Открыть файл сборки в FreeCAD.
2.  Открыть файл скрипта во FreeCAD.
3.  Кликнуть кнопку на панели инструментов <img alt="" src=images/Menu_Std_DlgMacroExecute_fr_02.png  style="width:24px;"> для запуска скрипта (так же называемого макрос).
4.  Перейти на вкладку со сборкой для наблюдения за вращением.

Измените что-нибудь в скрипте для практики и запустите снова. Например, измените *step* на *5*.

Вот результат анимации примера:

![](images/A2p_animated-example-result.gif )

#### Пример интерактивного скрипта 

Пример первого скрипта показывает создание анимации без вмешательства пользователя. Для большинства приложений Вам нужно вмешиваться в ход анимации. Например, интересный момент в примере - посмотреть как ведущие штифты пересекают центральную канавку колеса. Для более внимательного просмотра Вам следует представить эту деталь коллегам или начальнику. Поэтому вам нужно интерактивное решение.

Это может быть сделано использованием пользовательского диалога анимации со слайдером. Перемещая слайдер, Вы можете установить угол вращения и вращать вперёд и назад в интересующей позиции.

Мы используем тот же файл сборки [A2p\_animated-example.FCStd](https://forum.freecadweb.org/download/file.php?id=97554), и другой скрипт Python [A2p\_animation-example-script.py](https://forum.freecadweb.org/download/file.php?id=97982).


<div class="mw-collapsible mw-collapsed toccolours">

Вот содержимое скрипта для получения диалога интерактивной анимации:


<div class="mw-collapsible-content">


```python
# импорт библиотек
import time, math, PySide, sys
import FreeCAD.A2plus.a2p_solversystem as a2p_solver
from FreeCAD import Units
from PySide import QtCore, QtGui

# ждать 1 мс после каждого вычисления
timeout = 0.001
# мы берём текущий открытый документ
document = FreeCAD.activeDocument()
# нам нужно впоследствии изменять угол вращения детали "star_wheel_001"
starWheel = document.getObject("star_wheel_001")

class AnimationDlg(QtGui.QWidget): # диалог анимации

    def __init__(self): # для инициализации диалога
        super(AnimationDlg, self).__init__()
        self.initUI()

    def initUI(self): # описание компонентов диалогового окна
        self.setMinimumSize(self.minimumSizeHint()) # установливает минимальный размер диалогового окна на минимум
        self.setWindowTitle('Animation Dialog')
        # используем сеточный макет для всей формы
        self.mainLayout = QtGui.QGridLayout()
        self.lineNo = 0 # первая диалоговая строка в сетке
        # добавить метку описания
        DescriptionLabel = QtGui.QLabel(self)
        DescriptionLabel.setText("Change slider to change rotation angle")
        self.mainLayout.addWidget(DescriptionLabel,self.lineNo,0,1,4)
         # следующая диалоговая строка в сетке
        self.lineNo += 1
        # добавьте метку; нет необходимости в префиксе "self.", потому что мы не хотим менять метку позже
        LabelMin = QtGui.QLabel(self)
        LabelMin.setText("Min")
        LabelMin.setFixedHeight(32)
        self.mainLayout.addWidget(LabelMin,self.lineNo,0)
        # добавляем правку вращения, чтобы определить минимум ползунка
        self.MinEdit = QtGui.QSpinBox(self)
        # получаем единицы измерения угла в виде строки
        self.MinEdit.setSuffix(" " + str(FreeCAD.Units.Quantity(1, FreeCAD.Units.Angle))[2:])
        self.MinEdit.setMaximum(999)
        self.MinEdit.setMinimum(0)
        self.MinEdit.setSingleStep(10)
        self.MinEdit.setValue(0)
        self.MinEdit.setFixedHeight(32)
        self.MinEdit.setToolTip("Minimal angle for the slider")
        QtCore.QObject.connect(self.MinEdit, QtCore.SIGNAL("valueChanged(int)"), self.setMinEdit)
        self.mainLayout.addWidget(self.MinEdit,self.lineNo,1)
        # добавляем ползунок
        self.slider = QtGui.QSlider(QtCore.Qt.Horizontal, self)
        self.slider.setRange(0, 360)
        self.slider.setValue(0)
        self.slider.setFixedHeight(32)
        self.slider.setToolTip("Move the slider to change the rotation angle")
        QtCore.QObject.connect(self.slider, QtCore.SIGNAL("sliderMoved(int)"), self.handleSliderValue)
        self.mainLayout.addWidget(self.slider,self.lineNo,2)
        # добавляем метку
        LabelMax = QtGui.QLabel(self)
        LabelMax.setText("Max")
        LabelMax.setFixedHeight(32)
        self.mainLayout.addWidget(LabelMax,self.lineNo,3)
        # добавляем правку вращения, чтобы определить максимум ползунка
        self.MaxEdit = QtGui.QSpinBox(self)
        # получаем единицы измерения угла в виде строки
        self.MaxEdit.setSuffix(" " + str(FreeCAD.Units.Quantity(1, FreeCAD.Units.Angle))[2:])
        self.MaxEdit.setMaximum(999)
        self.MaxEdit.setMinimum(1)
        self.MaxEdit.setSingleStep(10)
        self.MaxEdit.setValue(360)
        self.MaxEdit.setFixedHeight(32)
        self.MaxEdit.setToolTip("Maximal angle for the slider")
        QtCore.QObject.connect(self.MaxEdit, QtCore.SIGNAL("valueChanged(int)"), self.setMaxEdit)
        self.mainLayout.addWidget(self.MaxEdit,self.lineNo,4)
         # следующая диалоговая строка в сетке
        self.lineNo += 1
        # добовляем spacere
        self.mainLayout.addItem(QtGui.QSpacerItem(10,10), 0, 0)
        # добавляем метку
        LabelCurrent = QtGui.QLabel(self)
        LabelCurrent.setText("Current angle:")
        LabelCurrent.setFixedHeight(32)
        self.mainLayout.addWidget(LabelCurrent,self.lineNo,1)
        # выводим текущий угол
        self.CurrentAngle = QtGui.QLineEdit(self)
        self.CurrentAngle.setText(str(0))
        self.CurrentAngle.setFixedHeight(32)
        self.CurrentAngle.setToolTip("Current rotation angle")
        self.CurrentAngle.isReadOnly()
        self.mainLayout.addWidget(self.CurrentAngle,self.lineNo,2)
        # добавляем метку для единиц измерения
        LabelUnit = QtGui.QLabel(self)
        LabelUnit.setText("deg")
        LabelUnit.setFixedHeight(32)
        self.mainLayout.addWidget(LabelUnit,self.lineNo,3)
        # кнопка для закрытия диалогового окна
        self.Close = QtGui.QPushButton(self)
        self.Close.setText("Close")
        self.Close.setFixedHeight(32)
        self.Close.setToolTip("Closes the dialog")
        QtCore.QObject.connect(self.Close, QtCore.SIGNAL("clicked()"), self.CloseClicked)
        self.mainLayout.addWidget(self.Close,self.lineNo,4)
        # размещаем нашу размеченную сетку в диалоговом окна
        self.setLayout(self.mainLayout)
        self.update()

    def handleSliderValue(self):
        # устанавливаем значение ползунка как угол
        starWheel.Placement.Rotation.Angle = math.radians(self.slider.value())
        # выводим текущий угол
        self.CurrentAngle.setText(str(self.slider.value()))
        # решаем ограничение 
        a2p_solver.solveConstraints(document)
        # обновляем вид после решения  ('Gui' stands for 'graphical user interface')
        FreeCADGui.updateGui()
        # ждём немного, т.к. нужно время для вычислений
        time.sleep(timeout)

    def setMinEdit(self):
        # убеждаемся что минимум меньше максимума
        if self.MinEdit.value() >=  self.MaxEdit.value():
            self.MaxEdit.setValue(self.MinEdit.value() + 1)
        self.slider.setRange(self.MinEdit.value(), self.MaxEdit.value())

    def setMaxEdit(self):
        # убеждаемся что минимум меньше максимума
        if self.MinEdit.value() >=  self.MaxEdit.value():
            self.MinEdit.setValue(self.MaxEdit.value() - 1)
        self.slider.setRange(self.MinEdit.value(), self.MaxEdit.value())

    def CloseClicked(self):
        AnimationDialog.close()

# создать и показать определённый выше диалог
AnimationDialog = AnimationDlg()
AnimationDialog.show()

# запустить цикл когда диалог станет видим
while AnimationDialog.isVisible():
    # обновить вид, важно чтобы дать обратную связь ОС для оживления диалога
    FreeCADGui.updateGui()
    # вынесение диалога вперёд, чтобы он был всегда видим
    QtGui.QWidget.raise_(AnimationDialog)
    # здесь так же выводится выходного ползунка, поскольку во время вычисления слайдер мог быть передвинут
    AnimationDialog.CurrentAngle.setText(str(AnimationDialog.slider.value()))
```


</div>


</div>

Диалог, определенный в скрипте, выглядит следующим образом:

![](images/A2p_AnimationDialog.png )

### Команды скрипта 

Чтобы лучше понять синтаксис скрипта, вот некоторая информация о командах: 
```python starWheel.Placement.Rotation.Angle = math.radians(angle)```

Здесь мы меняем свойство размещения `Rotation.Angle` детали, которая была преждде взята как `starWheel`. Это свойство даёт угол в [радианах](https://ru.wikipedia.org/wiki/Радиан). Функция `radians()` из библиотеки `math` преобразует угол из градусов в радианы.

Свойство `Rotation.Angle` использует текущее размещение осей детали (в нашем примере ось X). Для вращения детали, например, вокруг оси Z, надо установить ось вращения (перед вызовом команды вращения), используя команду: 
```python starWheel.Placement.Rotation.Axis = FreeCAD.Vector(0,0,1)``` Вместо вращения деталь может перемещаться. Чтобы изменить, например, размещение в направлении оси Y оси, команда должна быть: 
```python starWheel.Placement.Base.y = PositionShift``` В этом случае мы должны определять не переменную `angle`, а `PositionShift`, которую мы меняем каждый проход цикла.

Существуют разные способы установки размещения детали. Некоторые [документированы здесь](Placement/ru.md). К сожалению, списка со всеми возможными командами размещения не существует (пока). 
```pythona2p_solver.solveConstraints(document, useTransaction=False/True)```

Это специфичная для A2plus команда. Она разрешает сборочные ограничения сборки, которую мы ранее получили как `document`. Опция `useTransaction` указывает, если FreeCAD должен сохранять каждое изменение в стеке отмены/повтора. Поэтому для долгой анимации Вам следует установить её в `False`.




[Category:Addons{{\#translation:}}](Category:Addons.md) [Category:External Workbenches{{\#translation:}}](Category:External_Workbenches.md)
